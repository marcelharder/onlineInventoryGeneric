import { Component, OnInit } from '@angular/core';
import { ActivatedRoute } from '@angular/router';
import { AlertifyService } from 'src/app/_services/alertify.service';
import { HospitalService } from 'src/app/_services/hospital.service';
import { Location } from 'src/app/_models/Location';
import { DropItem } from 'src/app/_models/dropItem';

@Component({
  selector: 'app-list-locations',
  templateUrl: './list-locations.component.html',
  styleUrls: ['./list-locations.component.css']
})
export class ListLocationsComponent implements OnInit {

  selectedHospital: number;
  selectedVendor: number;
  listOfAvailableVendors: Array<DropItem> = [];
  sd=0;
  locationDetails: Location = {
    locationId: 0,
    naam: "",
    adres: "",
    postalCode: "",
    hospitalNo: 0,
    country: "",
    image: "",
    refHospitals: "",
    standardRef: "",
    email: "",
    contact: "",
    contact_image: "",
    telephone: "",
    fax: "",
    logo: "",
    mrnSample: "",
    sMS_mobile_number: "",
    sMS_send_time: "",
    triggerOneMonth: "",
    triggerTwoMonth: "",
    triggerThreeMonth: "",
    dBBackend: "",
    vendors: []
  }
  ah:Array<Location> = [];

  constructor(private route: ActivatedRoute, 
    private hos: HospitalService,
    private alertify: AlertifyService) { }

  ngOnInit() {
  this.route.data.subscribe((next)=>{
    this.ah = next.locs;
    // get List of available vendors
    this.hos.getListOfAvailableVendors().subscribe((next)=>{
      this.listOfAvailableVendors = next;
    });
  })
  }

  showDetails(){if(this.sd === 1)return true;}

  hospitalChanged(){
    this.sd = 1;
    this.alertify.message("Getting hospital details now ...");
    this.hos.getDetails(this.selectedHospital).subscribe((next)=>{
       this.locationDetails = next;
    })
  }
    updateLocationDetails(){
      this.hos.saveDetails(this.locationDetails).subscribe((next)=>{
        this.sd = 0;
        this.alertify.message("Updated ..");
      }, (error)=>{this.alertify.error(error)});
      
      }
    cancel(){ 
      this.sd = 0;
      this.alertify.message("Cancel");}
  
    deleteLocation(){this.alertify.message("Deleting ...");}
    addLocation(){this.alertify.message("Adding ...");}

    removeVendor(Description:string){
      this.hos.removeVendor(Description, this.selectedHospital).subscribe(
        (next)=>{
          this.alertify.message("Updated ..");
          let index = this.locationDetails.vendors.findIndex(a => a.value === this.selectedHospital);
          this.locationDetails.vendors.splice(index,1);
        }
      )
    }
    addVendor(){
      this.selectedVendor
      let index = this.listOfAvailableVendors.findIndex(a => a.value === this.selectedHospital);
      let dropItem = this.listOfAvailableVendors.find(a => a.value == this.selectedVendor);
      this.locationDetails.vendors.push(dropItem);
      this.listOfAvailableVendors.splice(index,1);
    }

    showDetailsVendor(Value: number){}
  

}
